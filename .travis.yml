services:
  - docker
os: linux
language: shell
jobs:
  include:
    - stage: build docker image
      script:
        # prepare qemu
        - docker run --rm --privileged multiarch/qemu-user-static:register --reset
        # push image
        - >
          if [ "$TRAVIS_BRANCH" = "master" -a "$TRAVIS_PULL_REQUEST" = "false" ]; then
            echo "$DOCKER_PASS" | docker login -u "$DOCKER_USER" --password-stdin
            docker build -t s1x/shstack-knxd .
            docker images
            ## TAGS
            echo "About to tag remote image '$DOCKER_USER'/shstack-knxd:latest'"
            docker tag s1x/shstack-knxd $DOCKER_USER/shstack-knxd:latest
            ## PUSH
            echo "About to push remote image '$DOCKER_USER'/shstack-knxd:latest'"
            docker push $DOCKER_USER/shstack-knxd:latest
          fi